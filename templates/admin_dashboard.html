{% if 'Admin' in session.get('roles', []) %}
<div class="container mt-5">
 <h2 class="text-center fw-bold my-4 py-3 px-4 bg-light border-start border-5 border-primary rounded-4 shadow-sm">
    Parking Lots Overview
</h2>

<div class="d-flex justify-content-center mb-4">
    <button class="btn btn-primary btn-lg px-4 shadow-sm" type="button" data-bs-toggle="offcanvas" data-bs-target="#add_lot" aria-controls="staticBackdrop">
        <i class="bi bi-plus-circle me-2"></i>Add Lot
    </button>
</div>
</div>

{% include 'add_parking_lot.html' %}

<div class="container">
    <div class="row g-4 justify-content-center">
        {% for lot in parking_lots %}
            <div class="col-12 col-md-6 col-lg-4 col-xl-3">
                <div class="card border-0 shadow-lg rounded-4 p-3 h-100 bg-white">
                    <h5 class="text-center fw-bold text-primary mb-3 border-bottom pb-2">Parking&nbsp;{{ lot.pl_id }}</h5>

                    <div class="text-center mb-3">
                        <a href="{{url_for('edit_parking_lot', lot_id = lot.pl_id )}}" class="me-2">
                            <button class="btn btn-outline-primary btn-sm px-3"><i class="bi bi-pencil"></i> Edit</button>
                        </a>
                        <a href="{{url_for('delete_parking_lot', lot_id = lot.pl_id)}}">
                            <button class="btn btn-outline-danger btn-sm px-3"><i class="bi bi-trash"></i> Delete</button>
                        </a>
                    </div>

                    <ul class="list-group list-group-flush mb-2 small">
                        <li class="list-group-item px-2 py-1"><strong>Location:</strong> {{ lot.prime_location_name }}</li>
                        <li class="list-group-item px-2 py-1"><strong>Price/hr:</strong> <span class="badge bg-success-subtle text-success fw-medium">â‚¹{{ lot.price }}</span></li>
                        <li class="list-group-item px-2 py-1"><strong>Address:</strong> {{ lot.address }}</li>
                        <li class="list-group-item px-2 py-1"><strong>Pincode:</strong> {{ lot.pincode }}</li>
                    </ul>

                    <p class="text-center fw-semibold text-success mt-2">
                        (Occupied: <span class="fw-bold">{{ get_spots_count(lot) }}</span>/<span class="fw-bold">{{ lot.max_spots }}</span>)
                    </p>

                    <hr class="my-2">

                    <div class="container">
                        <div class="row row-cols-5 g-2 text-center">
                            {% set spots = get_spots(lot) %}
                            {% for spot in spots %}
                                <div class="col">
                                    {% if spot.status == 'O' %}
                                        <a href="{{ url_for('reservation', spot_id=spot.spot_number) }}" style="text-decoration: none;">
                                            <div class="rounded-pill d-flex align-items-center justify-content-center shadow-sm border
                                                bg-success-subtle border-success text-success"
                                                style="width: 60px; height: 35px; font-weight: 600; font-size: 14px;"
                                                title="Spot Occupied">
                                                {{ spot.spot_number }}
                                            </div>
                                        </a>
                                    {% endif %}
                                    {% if spot.status == 'A' %}
                                        <div class="rounded-pill d-flex align-items-center justify-content-center shadow-sm border
                                            bg-danger-subtle border-danger text-danger"
                                            style="width: 60px; height: 35px; font-weight: 600; font-size: 14px;"
                                            title="Spot Available">
                                            {{ spot.spot_number }}
                                        </div>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
</div>
<br>
{% endif %}