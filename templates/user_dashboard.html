{% if 'User' in session.get('roles', []) %}

<!-- Reserved Parking Spots Section -->
<section class="my-5">
  <div class="container">
    <div class="card shadow border-0 rounded-4">
      <div class="card-header bg-gradient bg-primary text-white rounded-top-4">
        <h4 class="mb-0 fw-bold text-center">üÖøÔ∏è Reserved Parking Spots</h4>
      </div>
      <div class="card-body">
        {% set reservations = reserved_spots() %}
        {% if reservations %}
        <div class="table-responsive">
          <table class="table table-bordered table-hover align-middle mb-0">
            <thead class="table-light">
              <tr class="text-center">
                <th>Spot #</th>
                <th>Lot #</th>
                <th>Start Time</th>
                <th>End Time</th>
                <th>Vehicle</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              {% for reservation in reservations %}
              <tr class="text-center">
                <td><span class="badge bg-secondary">{{ reservation.ps_id }}</span></td>
                <td>{{ reservation.pl_id }}</td>
                <td>{{ reservation.start_time.strftime('%d %b %Y %I:%M %p') }}</td>
                <td>
                  {% if reservation.end_time %}
                    {{ reservation.end_time.strftime('%d %b %Y %I:%M %p') }}
                  {% else %}
                    <span class="text-muted">N/A</span>
                  {% endif %}
                </td>
                <td>{{ reservation.vehicle_number }}</td>
                <td>
                  {% if not reservation.released %}
                    <a href="{{ url_for('release', spot_id=reservation.ps_id) }}" class="btn btn-outline-danger btn-sm">
                      <i class="bi bi-x-circle"></i> Release
                    </a>
                  {% else %}
                    <span class="badge bg-light text-muted">Parked&nbsp;Out</span>
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
          <p class="text-muted text-center my-3">You don‚Äôt have any active reservations yet.</p>
        {% endif %}
      </div>
    </div>
  </div>
</section>

<!-- Reserve New Parking Spot Section -->
<section class="my-5">
  <div class="container">
    <div class="card shadow border-0 rounded-4">
      <div class="card-header bg-gradient bg-primary text-white rounded-top-4">
        <h4 class="mb-0 fw-bold text-center">üìç Available Parking Lots</h4>
      </div>
      <div class="card-body">
        {% if parking_lots %}
        <div class="table-responsive">
          <table class="table table-bordered table-hover align-middle mb-0">
            <thead class="table-light">
              <tr class="text-center">
                <th>Lot #</th>
                <th>Location</th>
                <th>Address</th>
                <th>Available</th>
                <th>Cost Per Hour</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              {% for lot in parking_lots %}
              <tr class="text-center">
                <td><strong>{{ lot.pl_id }}</strong></td>
                <td>{{ lot.prime_location_name }}</td>
                <td>{{ lot.address }}</td>
                <td>
                  <span class="badge bg-success fs-6">
                    {{ lot.max_spots - get_spots_count(lot) }}
                  </span>
                </td>
                <td>‚Çπ{{ lot.price }}/hr</td>
                <td>
                  <a href="{{ url_for('reserve', lot_id=lot.pl_id) }}" class="btn btn-outline-primary btn-sm">
                    <i class="bi bi-plus-circle"></i> Reserve
                  </a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
          <p class="text-muted text-center my-3">No available lots right now.</p>
        {% endif %}
      </div>
    </div>
  </div>
</section>

{% endif %}
